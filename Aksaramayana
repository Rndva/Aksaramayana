<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AksaRamayana - Karaton Edition (Fixed)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffcc00; --dark: #2b1a0a; --b-gold: #b8860b; --paper: #f0e6d2; --glass: rgba(20, 10, 5, 0.85); --fr: #ff4500; --fo: #ff8c00; --blood: #8a0303; --bg-fallback: #110805; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body, html { width: 100%; height: 100%; overflow: hidden; font-family: 'Lato', sans-serif; background: var(--bg-fallback); color: var(--paper); }
        h1, h2, .hp-label, #level-title, #continue-btn, .opt-btn, .hp-values, #timer-text, #transition-text, #story-title { font-family: 'Cinzel', serif; font-weight: 700; }

        /* --- UI & Overlay --- */
        #story-overlay { 
            position: fixed; inset: 0; 
            background: radial-gradient(circle, #2b1a0a 0%, #000 100%); 
            z-index: 3000; display: none; 
            flex-direction: column; justify-content: center; align-items: center; 
            padding: 20px; text-align: center;
            cursor: pointer;
        }
        
        #story-content { max-width: 800px; min-height: 150px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; }
        #story-title { color: var(--gold); font-size: 1.8rem; margin-bottom: 25px; letter-spacing: 6px; text-shadow: 0 0 20px rgba(255,204,0,0.4); opacity: 0; transform: translateY(20px); transition: all 1s ease; }
        #story-text { font-size: 1.1rem; line-height: 1.8; color: #f0e6d2; margin-bottom: 40px; font-style: italic; min-height: 80px; }
        .cursor { display: inline-block; width: 10px; height: 3px; background: var(--gold); margin-left: 5px; animation: blink .8s infinite; vertical-align: middle; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- STORY SCENE STYLES --- */
        #story-scene-img {
            max-width: 90%;
            max-height: 50vh;
            border: 2px solid var(--gold);
            box-shadow: 0 0 25px var(--gold);
            border-radius: 8px;
            object-fit: contain;
            display: none;
            animation: fadeInImg 0.8s ease;
            z-index: 3002;
        }
        #story-scene-text-box {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            margin-top: 20px;
            border-radius: 12px;
            max-width: 95%;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
            z-index: 3002;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }
        #story-scene-text-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #fff;
            text-shadow: 1px 1px 2px #000;
        }
        @keyframes fadeInImg { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeInBox { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Main Animations --- */
        @keyframes titleSlam { 0% { transform: scale(5); opacity: 0; filter: blur(20px); } 70% { transform: scale(0.9); opacity: 1; filter: blur(0); } 100% { transform: scale(1); opacity: 1; text-shadow: 0 0 30px var(--gold), 0 0 60px var(--fo); } }
        .title-animate { animation: titleSlam 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }

        /* --- Fire Particles --- */
        #fire-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; pointer-events: none; z-index: 5; overflow: hidden; }
        .spark { position: absolute; background: var(--fo); border-radius: 50%; filter: blur(1px); animation: rise var(--duration) linear infinite; opacity: 0; }
        @keyframes rise { 0% { transform: translateY(100%) translateX(0); opacity: 0; } 20% { opacity: 0.8; } 100% { transform: translateY(-500px) translateX(var(--drift)); opacity: 0; } }

        #game-container { position: relative; width: 100vw; height: 100vh; background: var(--bg-fallback); overflow: hidden; display: flex; flex-direction: column; }
        #screen-flash { position: absolute; inset: 0; background: radial-gradient(circle, var(--fo), var(--fr), transparent); opacity: 0; z-index: 1000; pointer-events: none; mix-blend-mode: overlay; transition: opacity 0.2s; }
        #damage-overlay { position: absolute; inset: 0; background: radial-gradient(circle, transparent 50%, rgba(255,0,0,0.6) 100%); opacity: 0; z-index: 900; pointer-events: none; transition: opacity 0.1s; }
        
        /* --- BACKGROUND FIX: ZOOM & BOTTOM ANCHOR --- */
        #battle-bg { 
            position: absolute; 
            inset: 0; 
            background-color: var(--bg-fallback); 
            background-size: 150% auto; 
            background-position: center bottom; 
            background-repeat: no-repeat;
            z-index: 1; 
            transition: background-image 0.5s ease;
        }

        /* --- TIME VIGNETTE --- */
        #time-vignette {
            position: absolute; inset: 0; pointer-events: none; z-index: 9; 
            box-shadow: inset 0 0 0 0 rgba(255,0,0,0);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        @keyframes pulseRed {
            0% { opacity: 0; box-shadow: inset 0 0 0 0 rgba(255,0,0,0); }
            50% { opacity: 1; box-shadow: inset 0 0 180px 40px rgba(255,0,0,0.4); }
            100% { opacity: 0; box-shadow: inset 0 0 0 0 rgba(255,0,0,0); }
        }
        .pulsing { animation: pulseRed 1s infinite; }

        /* --- Transitions --- */
        #level-transition { position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); z-index: 500; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; }
        #level-transition.active { opacity: 1; }
        #transition-content { text-align: center; border-top: 2px solid var(--gold); border-bottom: 2px solid var(--gold); padding: 40px 0; width: 100%; background: linear-gradient(90deg, transparent, rgba(184, 134, 11, 0.2), transparent); transform: scale(0.8); transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #level-transition.active #transition-content { transform: scale(1); }
        #transition-text { color: var(--gold); font-size: clamp(1.5rem, 6vw, 2.5rem); margin: 0; letter-spacing: 5px; text-shadow: 0 0 15px rgba(255, 204, 0, 0.5); }

        #battle-screen { display: none; width: 100%; height: 100%; position: relative; z-index: 2; flex-direction: column; }
        .hud { display: flex; justify-content: space-between; padding: 20px 25px; width: 100%; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent); z-index: 20; gap: 20px; }
        .hp-container { position: relative; flex: 1; min-width: 120px; }
        .hp-bar-bg { height: 18px; background: rgba(0,0,0,0.7); border: 1px solid var(--b-gold); margin-top: 5px; border-radius: 4px; overflow: hidden; position: relative; }
        .hp-bar-fill { height: 100%; width: 100%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        #player-hp { background: linear-gradient(90deg, #b8860b, #ffcc00); }
        #enemy-hp { background: linear-gradient(90deg, #800000, #ff0000); }
        .hp-values { position: absolute; width: 100%; text-align: center; top: 0; left: 0; font-size: 0.65rem; line-height: 18px; color: white; letter-spacing: 1px; text-shadow: 1px 1px 2px black; pointer-events: none; z-index: 5; }

        .timer-wrapper { position: absolute; top: 90px; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; z-index: 25; }
        .timer-container { width: 100px; height: 4px; background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; margin-bottom: 5px; }
        #timer-fill { height: 100%; width: 100%; background: var(--gold); }
        #timer-text { font-size: 2.5rem; color: white; text-shadow: 0 0 10px rgba(0,0,0,1); }

        .arena { position: absolute; bottom: 210px; left: 0; width: 100%; height: 38vh; display: flex; justify-content: center; align-items: flex-end; gap: 2%; pointer-events: none; z-index: 10; padding: 0 5%; }
        
        #player-img, #enemy-img { 
            height: auto; 
            max-height: 100%; 
            max-width: 48%; 
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), filter 0.2s;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.9)); 
            object-fit: contain; 
            will-change: transform, filter;
        }

        .char-attack { transform: scale(1.1) translateY(-20px) translateX(30px); z-index: 15; }
        .char-enemy-attack { transform: scale(1.2) translateX(-80px); z-index: 15; }
        .char-hurt { filter: brightness(0.6) sepia(1) hue-rotate(-50deg) saturate(4); transform: scale(0.95) translateY(10px); }
        .char-dead { filter: grayscale(100%) brightness(0.5); transform: translateY(40px) rotate(5deg); transition: all 1s ease; }

        .quiz-container { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); width: 88%; max-width: 550px; background: var(--glass); backdrop-filter: blur(15px); padding: 12px 18px; border: 1px solid rgba(184, 134, 11, 0.7); border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.9); z-index: 100; }
        #question { font-size: 0.95rem; text-align: center; margin-bottom: 12px; color: #fff; line-height: 1.3; text-shadow: 1px 1px 4px rgba(0,0,0,1); }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .opt-btn { background: rgba(255,255,255,0.08); border: 1px solid var(--b-gold); color: var(--paper); padding: 10px; cursor: pointer; border-radius: 6px; font-size: 0.8rem; transition: all 0.2s; letter-spacing: 0.5px; outline: none; position: relative; overflow: hidden; }
        .opt-btn:hover:not(:disabled) { background: var(--gold) !important; color: #000 !important; transform: translateY(-2px); }
        .opt-btn:active:not(:disabled) { transform: scale(0.98); }

        #menu-screen { position: absolute; inset: 0; background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.8)), url('https://i.postimg.cc/7YbpFym8/Menu.png'); background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 200; padding: 20px; overflow: hidden; }
        .menu-btns { display: flex; flex-direction: column; gap: 12px; width: 260px; z-index: 10; }

        #gameover-screen, #victory-screen { display: none; position: absolute; inset: 0; backdrop-filter: blur(6px); flex-direction: column; justify-content: center; align-items: center; z-index: 300; animation: fadeIn 0.5s ease-out forwards; text-align: center; }
        #gameover-screen { background: rgba(40, 0, 0, 0.9); }
        #victory-screen { background: rgba(10, 5, 2, 0.9); }

        .shake { animation: shakeEffect 0.4s ease-in-out; }
        @keyframes shakeEffect { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(-12px, 8px); } 50% { transform: translate(12px, -8px); } 75% { transform: translate(-12px, -8px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .explosion-fire { position: absolute; width: 150px; height: 150px; z-index: 2000; pointer-events: none; display: flex; justify-content: center; align-items: center; }
        .fire-core { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #fff 0%, #ffcc00 30%, #ff4500 60%, transparent 80%); border-radius: 50%; animation: fireBlast 0.5s ease-out forwards; }
        @keyframes fireBlast { 0% { transform: scale(0.2); opacity: 1; filter: brightness(2); } 100% { transform: scale(4); opacity: 0; filter: blur(10px); } }

        .floating-text { position: absolute; font-family: 'Cinzel', serif; font-weight: bold; font-size: 1.8rem; pointer-events: none; z-index: 120; animation: floatUp 1s ease-out forwards; text-shadow: 2px 2px 5px #000; white-space: nowrap; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 50% { transform: translateY(-60px) scale(1.2); } 100% { transform: translateY(-120px) scale(1); opacity: 0; } }

        #loading-overlay { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: var(--gold); }
        .loader-bar { width: 200px; height: 4px; background: #333; margin-top: 15px; border-radius: 2px; overflow: hidden; }
        .loader-fill { width: 0%; height: 100%; background: var(--gold); transition: width 0.2s; }

        /* --- MOBILE OPTIMIZATIONS --- */
        @media (max-width: 768px) {
            /* Base Mobile Styles */
            #battle-bg {
                background-size: 200% auto !important; 
                background-position: center bottom !important;
            }
            
            /* FORCE ZOOM for BAB 3, 4, & 5 (Index 2, 3, 4) */
            .zoom-battle #battle-bg {
                background-size: 280% auto !important; /* Zoom lebih dalam */
                background-position: center bottom !important;
                transform: translateY(0); /* Pastikan mentok bawah */
            }
            
            .quiz-container {
                bottom: 5px; 
                padding: 6px 10px; 
                max-width: 96%;
                width: 96%;
            }

            #question {
                font-size: 0.75rem; 
                margin-bottom: 6px;
            }

            .options-grid {
                gap: 4px;
            }

            .opt-btn {
                font-size: 0.7rem; 
                padding: 6px 2px; 
            }

            #rationale-text {
                font-size: 0.7rem;
                margin-bottom: 6px;
            }

            #continue-btn {
                padding: 4px 12px;
                font-size: 0.75rem;
            }

            #level-title {
                font-size: 0.5rem;
            }
            
            .arena {
                bottom: 170px; 
            }
        }
    </style>
</head>
<body>
<div id="loading-overlay">
    <div style="font-family: 'Cinzel'; font-size: 2rem; margin-bottom: 10px;">AKSARAMAYANA</div>
    <div id="loading-status" style="font-size: 0.8rem; letter-spacing: 4px; margin-bottom: 5px;">MEMUAT TAKDIR...</div>
    <div class="loader-bar"><div id="loader-fill" class="loader-fill"></div></div>
</div>

<!-- STORY OVERLAY -->
<div id="story-overlay">
    <div id="story-content">
        <!-- Intro Elements -->
        <h2 id="story-title">SERAT PURWAKA</h2>
        <div id="story-text"></div>
        <button id="skip-story-btn" class="opt-btn" style="opacity:0; transition:opacity 1s; padding: 12px 60px; margin: 0 auto;">MULAI PERJUANGAN</button>
        
        <!-- Scene Elements -->
        <img id="story-scene-img" src="" alt="Scene">
        <div id="story-scene-text-box">
            <div id="story-scene-text-content"></div>
        </div>
    </div>
</div>

<audio id="audio-menu" loop preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/ceb03776e38c4f4d49acb502302424fd91711b0c/menu.mp3"></audio>
<audio id="audio-battle" loop preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/97db58b5d604c46fce22d4622a35afe4c8764aa1/Epic%20Forge%20of%20the%20Gamelan.mp3"></audio>
<audio id="audio-boss" loop preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/3ec09bbeb1d706446a67ce6231864106304cbf36/Final%20Boss%20of%20Borobudur%20(1).mp3"></audio>
<!-- FINAL BOSS MUSIC (BAB 5) -->
<audio id="audio-final" loop preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/39a44e3468610e0709c50a4e0d286e4509bc6c9a/Rahwana%E2%80%99s%20Final%20Hour.mp3" type="audio/mpeg"></audio>

<audio id="sfx-confirm" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/ceb03776e38c4f4d49acb502302424fd91711b0c/confirm.wav"></audio>
<audio id="sfx-back" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/ceb03776e38c4f4d49acb502302424fd91711b0c/back.wav"></audio>
<audio id="sfx-bab" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/ceb03776e38c4f4d49acb502302424fd91711b0c/bab1.wav"></audio>
<audio id="sfx-hit-player" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/ceb03776e38c4f4d49acb502302424fd91711b0c/arrow.wav"></audio>
<audio id="sfx-hit-enemy" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/ceb03776e38c4f4d49acb502302424fd91711b0c/hit.wav"></audio>
<audio id="sfx-jayanti" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/0b31405679cfa4c1fae72d499ed38332f6ea1bd5/win.mp3"></audio>
<audio id="sfx-petjah" preload="auto"><source src="https://raw.githubusercontent.com/Rndva/Aksaramayana/0b31405679cfa4c1fae72d499ed38332f6ea1bd5/lose.mp3"></audio>
<!-- TYPING SFX -->
<audio id="sfx-type" preload="auto"><source src="https://assets.mixkit.co/active_storage/sfx/2570/2570-preview.mp3"></audio>

<div id="game-container">
    <div id="screen-flash"></div>
    <div id="damage-overlay"></div>
    <div id="battle-bg"></div>
    <div id="fire-container"></div>
    <div id="time-vignette"></div> 
    <div id="level-transition"><div id="transition-content"><h2 id="transition-text">BAB 1</h2></div></div>
    
    <div id="menu-screen">
        <h1 id="main-title" class="title-animate" style="font-size: clamp(2.2rem, 9vw, 5.5rem); color: var(--gold); margin: 0; text-align: center; z-index: 10;">AKSARAMAYANA</h1>
        <p style="letter-spacing: 8px; margin-bottom: 35px; font-family: 'Cinzel'; font-size: 1rem; opacity: 0.9; color: #fff; text-shadow: 0 0 10px #000; z-index: 10;">KARATON LEGACY</p>
        <div class="menu-btns">
            <button class="opt-btn" onclick="startNewJourney()" id="ui-start">PERJALANAN BARU</button>
            <button class="opt-btn" onclick="startGame(false)" id="ui-resume" style="display:none; border-color: #fff; background: rgba(255,255,255,0.1);">LANJUTKAN</button>
        </div>
        <p id="cloud-status" style="font-size: 0.65rem; margin-top: 20px; opacity: 0.6; color: #fff; z-index: 10;">Cloud Sync: Menghubungkan...</p>
    </div>

    <div id="battle-screen">
        <div class="hud">
            <div class="hp-container">
                <div id="player-name" class="hp-label" style="font-size: 0.8rem; color: var(--gold);">HERO</div>
                <div class="hp-bar-bg"><div id="player-hp" class="hp-bar-fill"></div><div id="player-hp-text" class="hp-values">100.000 / 100.000</div></div>
            </div>
            <div class="hp-container" style="text-align: right;">
                <div id="enemy-name" class="hp-label" style="font-size: 0.8rem; color: #ff4d4d;">MUSUH</div>
                <div class="hp-bar-bg"><div id="enemy-hp" class="hp-bar-fill"></div><div id="enemy-hp-text" class="hp-values">300.000 / 300.000</div></div>
            </div>
        </div>
        <div class="timer-wrapper"><div class="timer-container"><div id="timer-fill"></div></div><div id="timer-text">10</div></div>
        <div class="arena" id="arena">
            <img src="" id="player-img" alt="Hero">
            <img src="" id="enemy-img" alt="Musuh">
        </div>
        <div class="quiz-container" id="quiz-ui">
            <div id="rationale-box" style="display: none; text-align: center;">
                <div id="rationale-text" style="line-height: 1.4; font-size: 0.85rem; margin-bottom: 10px; color: #fff;"></div>
                <button id="continue-btn" class="opt-btn" style="background: var(--gold); color: #000; border:none; padding: 8px 25px;" onclick="nextAction()">LANJUTKAN</button>
            </div>
            <div id="quiz-content">
                <div id="level-title" style="text-align:center; color: var(--gold); font-size: 0.6rem; letter-spacing: 2px; margin-bottom: 5px; opacity: 0.7;">TINGKAT 1</div>
                <div id="question">Memuat soal...</div>
                <div id="options" class="options-grid"></div>
                <div style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
                    <div id="hint-text" style="font-style: italic; font-size: 0.65rem; color: #ccc;"></div>
                    <button id="ui-hint" onclick="useHint()" style="background:none; border: 1px solid var(--gold); color: var(--gold); padding: 3px 8px; border-radius: 4px; font-size: 0.6rem; cursor: pointer;">WISIK ISMAYA</button>
                </div>
            </div>
        </div>
    </div>

    <div id="victory-screen"><h1 style="color: var(--gold); font-size: 3rem; text-shadow: 0 0 20px gold;">JAYANTI!</h1><p style="text-align:center; margin-bottom: 20px;">Anda telah memenangkan seluruh pertempuran Karaton.</p><button class="opt-btn" onclick="backToMenu('victory')">KEMBALI KE KERATON</button></div>
    <div id="gameover-screen"><h1 style="color: #ff0000; font-size: 4rem; text-shadow: 0 0 20px #000; margin: 0;">PEJAH</h1><p style="color: #fff; margin: 10px 0 30px 0; font-family: 'Cinzel'; letter-spacing: 2px; font-size: 1.1rem;">Gugur ing madyaning paprangan</p><button class="opt-btn" onclick="retryLevel()" style="background: #ff0000; color: white; border: none; padding: 15px 40px; font-size: 1.2rem; box-shadow: 0 5px 15px rgba(0,0,0,0.5);">ULANGI PERJUANGAN</button><button class="opt-btn" onclick="backToMenu('gameover')" style="margin-top:15px; background: transparent; color: white; border: 1px solid white;">MENYERAH</button></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

// --- Config ---
let db, auth, appId;
const $ = id => document.getElementById(id);

// --- STORY STATE MANAGEMENT ---
let S = { l:0, qi:0, hp:100000, mx:100000, ehp:0, emx:0, pk: 'R', ek: 'H', ans:false, t:null, tl:10, uid:null, sceneIndex: 0 };
let storyState = 'intro'; // 'intro', 'scenes', 'ended'
let currentStoryKey = 'intro'; // 'intro', 'after1', 'after4', 'after5'
let introDone = false;
let isTyping = false;
let typeInterval = null;

// --- STORYLINE DATABASE ---
const STORY_DATA = {
    intro: [
        { img: "https://i.postimg.cc/qMrnPTj8/Story1Rest.png", text: "Rama, Sinta, dan laksmana sedang beristirahat di tengah Hutan Dandaka" },
        { img: "https://i.postimg.cc/jSg7nJK1/Story2Notice.png", text: "Sinta tak sengaja melihat sesuatu berkilauan di kejauhan hutan" },
        { img: "https://i.postimg.cc/DfLLpZQt/Story3Kijang.png", text: "KIJANG EMAS!!?, ternyata sesuatu yang berkilauan itu adalah rusa berwarna emas berkilau!" },
        { img: "https://i.postimg.cc/mZCCpDNf/Story4Hope.png", text: "Sinta pun memohon kepada Rama untuk menangkap Kijang itu untuknya.. dengan memohon imut, pria mana yang menolak permintaan kekasihnya.. kyaaaa...." },
        { img: "https://i.postimg.cc/SxTMYzqB/Story5KijangBow.png", text: "Rama pun mengejar kijang itu meninggalkan laksmana dan shinta" },
        { img: "https://i.postimg.cc/43Yh6NN2/Story6Teriak.png", text: "Tak lama kemudian terdengar teriakan Rama yang sangat keras seperti kesakitan, dan itu membuat Sinta khawatir dong.." },
        { img: "https://i.postimg.cc/htydQ7gN/Story7LeksmanaRekha.png", text: "laksmana lalu bergegas membuat garis pelindung untuk Dewi Sinta agar tidak keluar dari garis pelindung itu, dan menyusul Rama" },
        { img: "https://i.postimg.cc/Zn8NW7KP/Story8ShintaAlone.png", text: "Sinta sendirian di dalam garis pelindung dengan penuh rasa khawatir" },
        { img: "https://i.postimg.cc/prfjmGXk/Story9Brahmana.png", text: "tiba-tiba lewatlah brahmana tua rintih lemas, meminta air untuk diminum," },
        { img: "https://i.postimg.cc/Bv1ZzkFn/Story10.png", text: "Cewe mana yang ga iba, melihat brahmana tua kehausan, Akhirnya Shinta keluar dari garis pelindung dan tiba tiba tangannya ditarik oleh brahmana tersebut!" },
        { img: "https://i.postimg.cc/6QG6PgZ9/Story11.png", text: "TERNYATA Brahmana itu adalah Rahwana yang menyamar!, Diculik lah Sinta ke Langit!" }
    ],
    after1: [
        { img: "https://i.postimg.cc/h4LGq1WJ/Story12.png", text: "Jatayu tidak sanggup melawan Rahwana, ia jatuh ke tanah, dan sempat memberitahu Rama keberadaan Rahwana" },
        { img: "https://i.postimg.cc/vTb8XywL/StorySugriwa.png", text: "Rama akhirnya menemui Sugriwa raja kera, untuk memerintahkan Anoman membawa cincin dan menjemput Dewi Sinta" }
    ],
    after4: [
        { img: "https://i.postimg.cc/DwZfLVW5/Story15.png", text: "Anoman tertangkap!, semua Raksasa mengepung dan membakar Anoman!!" },
        { img: "https://i.postimg.cc/DwZfLVW5/Story15.png", text: "Dengan kesaktian Anoman, menjulang tinggi ke langit dan mengobrak abrik Alengka, ANOMAN OBONG!" },
        { img: "https://i.postimg.cc/tCC2X5Jz/alengka_fire.png", text: "Alengka Porak poranda lalu datang lah Rama dengan para pengawal untuk perang bersama para Raksasa!!" }
    ],
    after5: [
        { img: "https://i.postimg.cc/BvvJjpcV/SintaFire.png", text: "Setelah perang, Rama meragukan kesucian Sinta dan melakukan Agni Pariksa, membakar diri sendiri, dan ternyata Sinta baik baik saja, membuktikan bahwa Sinta masih Suci" },
        { img: "https://i.postimg.cc/ZKjKWYq3/Final.png", text: "Setelah membuktikan Kesuciannya, Rama dan Sinta kembali bersatu!" },
        { img: "https://i.postimg.cc/dVbhdz3p/GoodEnd.png", text: "So sweettt, tapi kasian Rahwana ga sie :(" }
    ]
};

// --- Assets Database ---
const AS = {
    R: { n:"Rama", i:"https://i.postimg.cc/Dyw7bGvX/Rama_idle.png", h:"https://i.postimg.cc/Dyw7bGvb/Rama_hurt.png", d:"https://i.postimg.cc/c4Ld83xg/Rama_dead.png", a:"https://i.postimg.cc/BQnJ1FS8/Rama_attack.png" },
    H: { n:"Rahwana", i:"https://i.postimg.cc/5N2fFz49/Rahwana_idle.png", h:"https://i.postimg.cc/nVkHz2J9/Rahwana_hurt.png", d:"https://i.postimg.cc/HW2pxzgc/Rahwana_dead.png", a:"https://i.postimg.cc/VsRY6g8J/Rahwana_attack.png" },
    K: { n:"Kumbakarna", i:"https://i.postimg.cc/05f8Qnsg/Kumbakarna_Idle.png", a:"https://i.postimg.cc/66093cNS/Kumbakarna_Attack.png", h:"https://i.postimg.cc/445JdPTr/Kumbakarna_Hurt.png", d:"https://i.postimg.cc/wxV6v2dC/Kumbakarna_Dead.png" },
    M: { n:"Marica", i:"https://i.postimg.cc/xjR0C52C/Marica_Idle.png", a:"https://i.postimg.cc/QNbXtm3j/Marica_Attack.png", h:"https://i.postimg.cc/pVZ2TCHd/Marica_Hurt.png", d:"https://i.postimg.cc/Wpn238vp/Marica_Dead.png" },
    J: { n:"Jatayu", i:"https://i.postimg.cc/ZnVZMbcx/Jatayu_Idle.png", a:"https://i.postimg.cc/d34vxsB9/Jatayu_Attack.png", h:"https://i.postimg.cc/zDjJB71c/Jatayu_Hurt.png", d:"https://i.postimg.cc/zDjJB71c/Jatayu_Hurt.png" },
    A: { n:"Anoman", i:"https://i.postimg.cc/3wW4pNZL/Anoman_Idle.png", a:"https://i.postimg.cc/QC0sy8bg/Anoman_Attack.png", h:"https://i.postimg.cc/Zq0B3nL7/Anoman_Hurt.png", d:"https://i.postimg.cc/XvXGFqgs/Anoman_Float.png" },
    W: { n:"Wilkataksini", i:"https://i.postimg.cc/vH2b7mT3/Wilkataksini_Idle.png", a:"https://i.postimg.cc/VLZm9NvR/Wilkataksini_Attack.png", h:"https://i.postimg.cc/4N2sv3yw/Wilkataksini_Hurt.png", d:"https://i.postimg.cc/kMzYKBJk/Wilkataksini_dead.png" }
};

// --- Question Database ---
const DB = [
    { t: "PERTEMPURAN PERTAMA: JATAYU!", p: "J", k: "H", n: "RAHWANA", mx: 200000, q: [
        { q: "Jatayu sedang terbang di langit tidak sengaja melihat apa", a: ["Dewi Sinta yang diculik Rahwana", "Kolam danau", "Rama dan Laksmana", "Kijang Kencana"], c: "Dewi Sinta yang diculik Rahwana", h: "Lagi enak enak auto pilot, malah liat apa tuch", r: "Kebetulan lagi terbang ga sengaja liat Dewi Sinta yang diculik Rahwana sekalian nolongin deh" },
        { q: "Siapa burung raksasa sahabat Prabu Dasarata yang berusaha menyelamatkan Dewi Sinta?", a: ["Resi Jatayu", "Sempati", "Garuda", "Naga"], c: "Jatayu", h: "eemm itu ada deh pokoknya buwung ayu", r: "Jatayu berjuang habis-habisan melindungi kehormatan Sinta." },
        { q: "Jatayu berperang melawan Rahwana di posisi apa?", a: ["Mage", "Hyper", "Tank", "Support"], c: "Support", h: "Lagi lewat sekalian nolongin", r: "Jatayu bertugas sebagai Support yang menyerap serangan Rahwana." },
        { q: "Senjata Rahwana yang putus sayap Jatayu adalah...", a: ["Pedang Chandrahasa", "Gada Rujakpolo", "Cakra", "Panah Panca"], c: "Pedang Chandrahasa", h: "eummm itu nya samurai pake apa yah", r: "Rahwana menggunakan Pedang Chandrahasa yang memutus sayap Jatayu." },
        { q: "Sahabat karib Jatayu di Ayodhya adalah?", a: ["Prabu Dasarata", "Sugriwa", "Wibisana", "Gatotkaca"], c: "Prabu Dasarata", h: "Ayahnya Rama siapa ya?", r: "Jatayu dihormati tinggi karena sahabat ayah Rama." },
        { q: "Setelah kalah, ke mana Jatayu pergi sebelum mati?", a: ["Ke Lobby Utama", "Ke Hutan Dandaka", "Ke Alengka", "Logout"], c: "Ke Hutan Dandaka", h: "Balik ke base camp untuk ketemu Rama.", r: "Ia terbang ke Hutan Dandaka untuk memberi info lokasi Sinta." },
        { q: "Jatayu melawan Rahwana demi melindungi...", a: ["Dewi Sinta", "Cendrawasih", "Rama", "Putri"], c: "Dewi Sinta", h: "kekasihnya rama", r: "Meski kalah fisik, Jatayu menang moral karena membela Sinta." },
        { q: "Rahwana menyamarkan jadi Brahmana Tua untuk apa?", a: ["Bosen jadi raksasa", "Mencuri hati iba Sinta", "Kebelet tua", "Mengalihkan perhatian Rama"], c: "Mencuri hati iba Sinta", h: "Akting", r: "Rahwana pura-pura membohongi Sinta agar mengikuti dia." },
        { q: "Jatayu adalah putra Dewa...", a: ["Garuda", "Bayu", "Agni", "Brahma"], c: "Bayu", h: "yang namanya Bayu emang OP", r: "Sebagai anak Dewa Bayu, Jatayu mewarisi kecepatan terbang." },
        { q: "Bagian tubuh Jatayu yang dipotong Rahwana adalah...", a: ["Kepala", "Sayap", "Kaki", "Telinga"], c: "Sayap", h: "betul bgt burung kan ga bisa terbang tanpa itu", r: "Sayap Jatayu putus oleh Cakra Rahwana dalam pertarungan brutal." },
        { q: "Sinta meninggalkan garis proteksi (Laksmana Rekha) karena...", a: ["Mau Donasi ke Pengemis", "Iba melihat brahmana tua", "Laper Mager", "Jalan-jalan"], c: "Iba melihat brahmana tua", h: "itu yang tadi tuh gegara brahmana", r: "Sinta keluar dari garis karena kasihan melihat brahmana tua kehausan" },
        { q: "Jatayu vs Rahwana, hasil pertandingan...", a: ["Jatayu Menang", "Seri (Draw)", "Rahwana Menang", "Game Over"], c: "Rahwana Menang", h: "minion vs lord", r: "Jatayu gugur sebagai pahlawan yang berkorban." },
        { q: "Kenapa Rahwana sangat sulit dikalahkan?", a: ["Ilmu Patih Geni", "Punya Ilmu Pancasona", "Wahyu Dewa Bayu", "ngbug"], c: "Punya Ilmu Pancasona", h: "Cheat Code abadi 5 mempesona.", r: "Selama menyentuh tanah, dia bisa 'respawn' lagi." },
        { q: "Apa yang dilakukan Rama setelah mendengar cerita Jatayu?", a: ["Mengejar Rahwana", "Menangis", "Meminta pertolongan Raja Kera", "Makan"], c: "Meminta pertolongan Raja Kera", h: "Jatayu memberi infone mas-e, kerajaan alengka", r: "Info dari Jatayu membuat Rama menemui Sugriwa untuk memerintahkan anak buah keranya pergi ke Alengka" },
        { q: "Jatayu melambung tinggi saat...", a: ["Menyerang", "Hidup", "Mati", "Nembak"], c: "Menyerang", h: "Volume suara Jatayu sangat tinggi saat duel.", r: "Gemuruh cakar Jatayu menggetarkan langit." },
        { q: "Jatayu dianggap sebagai...", a: ["Burung Pesolek", "Monster", "Ksatria", "NPC"], c: "Burung Pesolek", h: "Soleh", r: "Meski burung, Jatayu memiliki ilmu kesaktian (Magic Damage)." },
        { q: "Apakah Jatayu berhasil menyelamatkan Sinta?", a: ["Sempurna", "Sebagian", "Tidak", "Hampir"], c: "Hampir", h: "Dia mencegah Rahwana, tapi Sinta tetap dibawa pergi duluan. hampir aja", r: "Jatayu berjuang habis-habisan namun Rahwana kabur membawa Sinta. hampir aja" },
        { q: "Apa senjata ampuh yang juga dipegang Jatayu?", a: ["Cakar dan paruh", "Gada", "Naga Pasa", "Panah"], c: "Cakar dan paruh", h: "namanya juga burung", r: "Jatayu mencabik cabik melawan Rahwana." },
        { q: "Nama kakak Jatayu adalah...", a: ["Sampati", "Agnitra", "Ariswena", "Nila"], c: "Sampati", h: "Sampati adiknya yang juga burung raksasa.", r: "Sampati nanti yang menemani Rama mencari Sinta." },
        { q: "Peran Jatayu dalam perang Ramayana adalah...", a: ["Mencegah Rahwana menculik Sinta", "buwung npc", "Adiknya Wibisana", "Temannya Anoman"], c: "Mencegah Rahwana menculik Sinta", h: "Ketua ga sanggup lawan Rahwana, tapi Jatayu sudah berusaha semaksimal mungkin, tapi nihil" },
        { q: "Kenapa Jatayu rela mati?", a: ["Demi menyelamatkan Dewi Sinta", "Kepencet Defeat", "Ga sanggup melawan Rahwana", "pasrah akan takdir"], c: "Demi menyelamatkan Dewi Sinta", h: "Menyelamatkan mantu dari sahabatnya", r: "Jatayu menyampaikan pesan terakhirnya di detik kematiaannya agar Rama menuju Alengka" }
    ]},
    { t: "GATEKEEPER: WILKATAKSINI!", p: "A", k: "W", n: "WILKATAKSINI", mx: 200000, q: [
        { q: "Siapa yang mengirim Anoman ke Alengka?", a: ["Sugriwa", "Vali", "Rama", "Hanoman sendiri"], c: "Sugriwa", h: "Ketua Guild (Kera) yang kasih quest ke Anoman.", r: "Sugriwa memberi misi menyusup ke Alengka, atas perintah Rama dan membawakan cincin untuk menguji kesucian Sinta" },
        { q: "Cara Anoman mengalahkan Wilkataksini adalah...", a: ["Duel 1v1", "Membelah Perut Wilkataksini", "Banting ke darat", "Dibakar"], c: "Membelah Perut Wilkataksini", h: "Wilkataksini melahap Anoman!", r: "Anoman membelah perut Wilkataksini" },
        { q: "Wilkataksini terinspirasi dari cahaya dewa...", a: ["Surya & Kartika", "Wisnu & Siwa", "Brahma & Brahma", "Shiva & Shakti"], c: "Wisnu & Siwa", h: "Dia punya buff dari dua Developer (Dewa).", r: "Kesaktian Wilkataksini berasal dari gabungan Wisnu dan Siwa." },
        { q: "Kenapa Anoman akhirnya bisa menang?", a: ["Alurnya gitu kan?", "Kesaktian Anoman!", "Rama membantu", "Punakawan jadi tumbal"], c: "Kesaktian Anoman!", h: "Mechanik Wilkataksini kalah sama DPS Anoman.", r: "Wilkataksini kuat tapi Anoman lebih cepat dan gesit." },
        { q: "Anoman mencari Sinta di...", a: ["Taman Argasoka", "Gua", "Laut Alengka", "Hutan"], c: "Taman Argasoka", h: "Target mark ada di Taman.", r: "Rahwana memperlakukan Sinta dengan baik, ditempatkan di Taman Argasoka, surganya dunia!" },
        { q: "Wilkataksini kalah karena...", a: ["Kalah Mekanik", "Kepencet", "Anoman lebih Sakti", "Udah tua"], c: "Anoman lebih Sakti", h: "Mechanik Wilkataksini kalah sama DPS Anoman.", r: "Wilkataksini kuat tapi Anoman lebih cepat dan gesit." },
        { q: "Apa senjata andalan Wilkataksini?", a: ["Gada Besi", "Trisula", "Cakra", "Panah"], c: "Gada Besi", h: "Senjata jarak dekat dan berat.", r: "Dia menggunakan Gada Besi untuk menghantam Anoman." },
        { q: "Apakah Rahwana tahu Anoman masuk lewat gerbang?", a: ["tidak", "taulah", "ada cctv", "anak buahnya liat"], c: "tidak", h: "Anoman menyelinap masuk yakali ketauan izinn..", r: " Rahwana tidak mengetahui secara langsung saat Anoman pertama kali melewati gerbang Alengka." },
        { q: "Kenapa Anoman membakar taman Alengka?", a: ["Balas Dendam", "Jahil", "Miskin", "Troll"], c: "Balas Dendam", h: "Gara-gara bener gara-gara, karena Rahwana toxic.", r: "Rahwana menghina Anoman sebagai tamu, Anoman balas membakar istan." },
        { q: "Tugas utama Wilkataksini sebelum dia kalah: ?", a: ["Penjaga wilayah laut Alengka", "Penjaga Gerbang", "Penjaga Istana", "Penjaga Kandang"], c: "Penjaga wilayah laut Alengka", h: "Buaya masa di laut, eh ada buaya laut ya?", r: "Penguasa Wilayah laut Alengka ialah Wilkataksini bray" },
        { q: "Siapa kakak Wilkataksini?", a: ["Prahasta", "Lembusura", "Kumbakarna", "Rahwana"], c: "Prahasta", h: "Prahasta adalah kakaknya, juga boss lain.", r: "Keluarga besar Wilkataksini di Alengka." },
        { q: "Apa Wilkataksini setuju Rahwana menculik Sinta?", a: ["Yakin, banget", "Ga setuju tapi harus nurut ish", "Setuju", "Bodo amat"], c: "Ga setuju tapi harus nurut ish", h: "Dia jahat tapi loyal dan bijak.", r: "Karyawan harus patuh, meski bosnya (Rahwana) toxic." },
        { q: "Anoman mengalahkan Wilkataksini dengan...", a: ["One Punch", "Combo Kill", "Magic Spell", "Ultimate"], c: "One Punch", h: "Pukulan super kritis yang bikin layar bergetar.", r: "Satu pukulan Anoman membuat Wilkataksana K.O." },
        { q: "Wilkataksini adalah tipe musuh...", a: ["Bruiser", "Tank", "Assassin", "Ranger"], c: "Bruiser", h: "HP gede, damage tinggi, slow attack.", r: "Wilkataksini adalah Boss jebolan dengan HP tebal." },
        { q: "Anoman sebelum lawan Wilkataksini mengonsumsi apa...", a: ["Tahu kecil", "Kacang", "Durian", "Es Gabus"], c: "Tahu kecil", h: "Minum Tahu Kecil biar skill spam cepet.", r: "Anoman minum Tahu Kecil ditemani punakawan" },
        { q: "Punakawan ikut dengan Anoman pake apa?", a: ["Pake Karpet terbang", "Jalan kaki", "Ikut di ekornya Anoman", "Pake Kuda"], c: "Ikut di ekornya Anoman", h: "Anoman berubah jadi raksasa", r: "bergelantungan di ekor Anoman dan terbang" },
        { q: "Di tengah perjalanan Anoman di Goa Kiskenda, ia diracuni oleh seorang dewi siapakah itu?", a: ["Dewi Drupada", "Dewi Sayempraba", "Dewi Kunti", "Dewi Tari"], c: "Dewi Sayempraba", h: "Dewi di Goa Kiskenda, [sayembara] itulah pokoknya", r: "Cantik-cantik tapi suka bikin sakit hati, Anoman diracuni jadi buta" },
        { q: "Siapa nama istrinya Wilkataksini?", a: ["Tari", "Indriyanti", "Sarpakenaka", "Widawati"], c: "Tari", h: "Istri cantik tapi sayangnya miring (follow toxic boss).", r: "Tari setia kepda suaminya, walau suaminya salah." },
        { q: "Siapa yang menyelamatkan kebutaan Anoman keracunan", a: ["Garuda Sempati", "Resi Jatayu", "Punakawan", "Sugriwa"], c: "Garuda Sempati", h: "Punakawan bertemu Garuda Sempati Ketika mencari obat", r: "Punakawan lagi nyari obat ga ketemu-temu, eh ketemu Garuda Sempati dan ketemu deh obatnya" },
        { q: "Wujud dari Wilkataksini dalah", a: ["Siluman Buaya", "Siluman Biawak", "Siluman Komodo", "Siluman Naga"], c: "Siluman Buaya", h: "Dia jadi penjaga pertama yang menghalangi jalan Anoman.", r: "Anoman harus mengalahkan dia untuk melanjutkan ke boss berikutnya." }
    ]},
    { t: "TRIK MUSLIHAT: MARICA", p: "A", k: "M", n: "MARICA", mx: 300000, q: [
        { q: "Saat pertama kali ke Alengka, Anoman bertarung dengan penjaga lautan bernama...", a: ["Wilkataksini", "Lembusura", "Jambumangli", "Prahasta"], c: "Wilkataksini", h: "Seorang rakshasa siluman buaya darat :<.", r: "Anoman berhasil mengalahkan Wilkataksini dengan satu pukulan." },
        { q: "Anoman mengubah ukuran tubuhnya menjadi raksasa untuk mengintip...", a: ["Taman Sokanegara", "Istana Alengka", "Gunung Mahameru", "Lautan Selatan"], c: "Istana Alengka", h: "Ia membesarkan tubuh saat berada di gerbang.", r: "Anoman mengamati dan mencari Sinta dari atas istana dengan bentuk raksasa." },
        { q: "Wilkataksini adalah kekuatan dari pertemuan dewa...", a: ["Wisnu dan Siwa", "Bayu dan Indra", "Brahma dan Siwa", "Surya dan Candra"], c: "Wisnu dan Siwa", h: "Kekuatan dua dewa paling OP!.", r: "Kekuatannya besar namun tidak cukup untuk melawan kesaktian Anoman." },
        { q: "Setelah mengalahkan Wilkataksini, Anoman melanjutkan perjalanan ke...", a: ["Taman Argasoka", "Dapur Alengka", "Barisan prajurit", "Kamar Rahwana"], c: "Taman Argasoka", h: "Tempat Sinta ditahan.", r: "Ia melihat Sinta sedang bersedih di bawah pohon soka." },
        { q: "alasan ada punakawan di ramayana", a: ["Penyampai Pesan Moral dan Dakwah", "Emang gitu ceritanya kocak", "Ngbug", "Kepencet login"], c: "Penyampai Pesan Moral dan Dakwah", h: "Penghibur", r: "Punakawan ditambahkan untuk menghidupkan cerita, menyampaikan nilai-nilai luhur budaya Jawa, dan mendekatkan kisah epic Ramayana dengan kehidupan masyarakat Jawa. " },
        { q: "Wujud samaran Marica saat mengejar Rama adalah...", a: ["Rusa Emas", "Kuda Nil", "Naga", "Gajah Putih"], c: "Rusa Emas", h: "Skin event 'Kijang Kencana', limited edition.", r: "Marica pakai skin rusa untuk menipu Sinta. " },
        { q: "Kenapa Marica memilih jadi Rusa?", a: ["Menarik Perhatian Sinta", "Lincah", "kepencet skill", "Mager"], c: "Menarik Perhatian Sinta", h: "Ketertarikan Perempuan Dalam hal emas", r: "Marica memisahkan Rama agar Laksmana sendiri yang menjaga Sinta." },
        { q: "Sebelum jadi rusa, Marica menyamar menjadi...", a: ["Gajah Putih", "Kijang Emas", "Banteng", "Singa"], c: "Gajah Putih", h: "Gagal, terlalu tanky, wanita ga tertarik guys", r: "Gajah Putih adalah reinkarnasi jebakan Marica sebelum rusa." },
        { q: "Siapa yang membunuh Marica (Versi Wayang)?", a: ["Rama", "Laksmana", "Lembu Sura", "Karna"], c: "Rama", h: "Marksman yang nembak Marica.", r: "Rama tidak terkecoh tipu daya Marica, langsung menembaknya." },
        { q: "Sinta tertipu karena Rahwana menyamar sebagai...", a: ["Rama", "Laksmana", "Brahmana Tua", "Pedagang"], c: "Brahmana Tua", h: "Cewe mana yang ga iba liat orang tua rintih", r: "Sinta mengira Brahmana suci dan mengikutiinya keluar garis." },
        { q: "Rama mengejar Rusa Emas karena...", a: ["Keinginan Kekasihnya", "Kelaparan", "Terbuai", "Curious"], c: "Keinginan Kekasihnya", h: "Act of service bgt kyaaa", r: "Rama selalu menuruti kekasihnya." },
        { q: "Dalam konteks Game, apa peran Marica?", a: ["Mini Boss / Decoy", "Main Tank", "NPC Pedagang", "Minion"], c: "Mini Boss / Decoy", h: "Marica cuma Decoy sebelum Boss utama (Rahwana).", r: "Tugasnya cuma memisahkan carry (Rama)." },
        { q: "Marica dikenal sebagai ahli...", a: ["Magician", "Warlock", "Bard", "Assassin"], c: "Magician", h: "Kelasnya Sorcerer (Mage) yang bisa ilusi.", r: "Dia ahli dalam kedirian (Illusion Magic)." },
        { q: "Apa yang dilakukan Laksmana ke Rusa Emas?", a: ["Tembak Jitu", "Lompat Tali", "Ulti", "Block"], c: "Tembak Jitu", h: "Laksmana tidak mau basa-basi, langsung tap skill damage.", r: "Panah Laksmana melukai rusa tersebut." },
        { q: "Marica vs Jatayu, siapa yang lebih kuat?", a: ["Jatayu", "Marica", "Imbang", "Draw"], c: "Jatayu", h: "Jatayu punya stats lebih tinggi, Marica cuma support.", r: "Jatayu adalah veteran, Marica baru recruit." },
        { q: "Apa nama Rusa Emas dalam Ramayana?", a: ["Kijang Kencana", "Rusa Perak", "Bima", "Kuda Nil"], c: "Kijang Kencana", h: "Kijang Kencana adalah legenda, bukan kuda biasa.", r: "Bulu Kijang ini terbuat dari emas murni." },
        { q: "Rama mengejar Kijang Emas sampai ke...", a: ["Ujung Dunia", "Hutan Soka", "Pantai", "Desa Terbuang"], c: "Pantai", h: "Rama di-panah sampai jatuh di pantai", r: "Tidak bisa dikejar lagi karena Rama sudah menembaknya." },
        { q: "Marica siapanya Rahwana?...", a: ["Patih", "Adiknya", "Anaknya", "Kakaknya"], c: "Patih", h: "penasihat Rahwana", r: "padahal udah dinasehatin jangan nyolong istri orang, ya gitu deh" },
        { q: "Putra Kesayangan Rahwana siapa guys", a: ["Indrajit", "Surpanaka", "Wibisana", "Kumbakarna"], c: "Indrajit", h: "sangat sayang dengan anak yang kemudian diberi nama Indrajit.", r: "Anak kesayangan papih wana" },
        { q: "Setelah Marica tewas, Rahwana jadi...", a: ["Rage Mode", "Cry", "Sleep", "AFK"], c: "Rage Mode", h: "Dia langsung mode marah (Enrage).", r: "Kematian Marica memancing kemarahan Rahwana." },
        { q: "Siapa yang memperkirakan Marica lari ke Rahwana?", a: ["Wilkataksini", "Sarpakenaka", "Jentaka", "Data Server"], c: "Wilkataksini", h: "Admin laut lapor ke boss.", r: "Wilkataksini melihat Marica lari ke arah istana Rahwana." },
        { q: "Strategi Marica ini adalah...", a: ["Diversion", "Zerg Rush", "Ambush", "Tower Defense"], c: "Diversion", h: "Mengalihkan Carry (Rama) dari Support (Laksmana).", r: "Trik memisahkan tim musuh agar Carry (Sinta) tanpa bodyguard." }
    ]},
    { t: "RAKSAA BESAR: KUMBAKARNA", p: "A", k: "K", n: "KUMBAKARNA", mx: 400000, q: [
        { q: "Raksasa raksasa yang tidur selama enam bulan adalah...", a: ["Kumbakarna", "Rahwana", "Indrajit", "Prahasta"], c: "Kumbakarna", h: "Suara dengkurannya menggetarkan bumi.", r: "Dibangunkan paksa oleh pasukan Alengka untuk perang." },
        { q: "Apa strategi Anoman menghadapi tubuh raksasa Kumbakarna?", a: ["Menyusut menjadi ulat", "Membesarkan tubuh", "Menyerang dengan telapak tangan", "Menyemburkan api"], c: "Menyusut menjadi ulat", h: "Masuk ke mulut Kumbakarna.", r: "Anoman mengganggu tenggorokan Kumbakarna dari dalam." },
        { q: "Anoman menggunakan senjata Gada bernama...", a: ["Gada Anoman", "Gada Rujakpolo", "Gada Wesi", "Gada Kayu"], c: "Gada Anoman", h: "Gada kesaktian miliknya.", r: "Gada ini cukup berat untuk melukai tubuh kebal Kumbakarna." },
        { q: "Siapa yang akhirnya menghabisi nyawa Kumbakarna?", a: ["Rama", "Anoman", "Laksmana", "Sugriwa"], c: "Rama", h: "Dengan panah Guwawijaya.", r: "Rama memotong anggota tubuh Kumbakarna satu per satu." },
        { q: "Apa pesan terakhir Kumbakarna sebelum wafat?", a: ["Lupakan aku, lanjutkan perang", "Hiduplah bahagia Rahwana", "Mati adalah tidur panjang", "Anakku sayang"], c: "Lupakan aku, lanjutkan perang", h: "Ia tahu perangnya sia-sia, pasrah aja udah", r: "Kumbakarna memilih mati demi harga diri sebagai prajurit." },
        { q: "Kumbakarna tidur berapa tahun sekali bangun?", a: ["6 Bulan", "1 Tahun", "100 Hari", "1 Malam"], c: "6 Bulan", h: "Mode AFK paling lama.", r: "Dia bobo 6 bulan, baru bangun kalau dipaksa (diserang musuh)." },
        { q: "Kumbakarna bangun dari tidur saat...", a: ["laper", "kebelet", "perang", "rahwana memanggil"], c: "perang", h: "Alarm perang membangunkan AFK-nya.", r: "Pertempuran memaksa Kumbakarna untuk bangkit. maksa bgt padahal enak bobo" },
        { q: "Siapa yang menyerang Kumbakarna saat itu?", a: ["Anoman & Sugriwa", "Rama & Laksmana", "Garuda Sempati", "Jatayu"], c: "Anoman & Sugriwa", h: "Pasukan Kera", r: "Kera mengeroyosi Kumbakarna bersama Anoman." },
        { q: "Kumbakarna melawan demi...", a: ["Gaji / Gaji", "Poin", "Rank", "Love"], c: "Gaji / Gaji", h: "Dia kerja demi gaji (honor) dan negara.", r: "Baginya bukan raja, tapi patriot yang setia." },
        { q: "Anoman masuk ke mulut Kumbakarna untuk...", a: ["Meledakkan tubuh Kumbakarna", "Menyebar Virus", "Menggelitik Perut Kumbakarna", "Merobek perut Kumbakarna"], c: "Meledakkan tubuh Kumbakarna", h: "ibarat kate semut masuk ke belalai gajah, tapi semut gede", r: "Anoman memperbesar badan hancurkan Kumbakarna dari dalam." },
        { q: "Apa senjata pamungkas Rama?", a: ["Panah Guwawijaya", "Cakra", "Gada", "Naga Pasopati"], c: "Panah Guwawijaya", h: "Item Divine dari Brahma, super overpowered.", r: "Hanya Guwawijaya yang bisa mengalahkan Cheat Code Pancasona." },
        { q: "Kumbakarna berbadan besar raksasa tapi mempunyai...", a: ["Perut kecil", "Wajah tampan", "Otot Kekar", "Loyalty"], c: "Loyalty", h: "Dia jelek tapi loyal (gak ikut server musuh).", r: "Dia menghujat kakaknya (Rahwana) tapi tetap membela negara." },
        { q: "Siapa kakak yang menyarankan perang besar ini?", a: ["Wibisana", "Marica", "Lembusura", "Indrajit"], c: "Wibisana", h: "Wibisana tau Rahwana salah, tapi disuruh fight.", r: "Wibisana setuju perang demi kebenaran." },
        { q: "Kenapa Shinta tidak mau dengan Rahwana?", a: ["Rahwana Selingkuh", "Muka Rahwana jelek", "Kesetiaan", "Perutnya ga sixpath"], c: "Kesetiaan", h: "Masih Setia dong.", r: "karena ia ingin Rama yang datang sendiri ke Alengka untuk merebutnya dari tangan Rahwana dengan gagah berani." },
        { q: "Anoman membawakan cincin dari Rama untuk Sinta buat apa", a: ["Cincinnya ketinggalan", "Bukti Anoman utusan Rama", "Bukti Keperawanan Sinta", "Bukti Cinta"], c: "Bukti Anoman utusan Rama", h: "Biar dikira Anoman bukan Jelmaan Rahwana", r: "Cincin tersebut meyakinkan Sinta bahwa utusan di depannya bukanlah jelmaan Rahwana, melainkan benar-benar utusan suaminya." },
        { q: "Anoman dibantu oleh...", a: ["Rama & Laksmana", "Sugriwa & Anggada", "Jatayu", "Garuda"], c: "Rama & Laksmana", h: "Main DPS & Healer.", r: "Tim Rama membantu Anoman menghabisi Kumbakarna." },
        { q: "Kumbakarna tak bisa mati karena...", a: ["Auto-Revive", "Pancasona", "God Mode", "Infinite HP"], c: "Pancasona", h: "Selama menyentuh tanah, HP full kembali.", r: "Jantung 'server' (tanah) mereset HP dia." },
        { q: "Anoman menggunakan trik masuk mulut karena...", a: ["Shrink", "Invisibility", "Speed", "Teleport"], c: "Shrink", h: "Anoman mengecil (Shrink) biar lolos scan.", r: "Anoman menyusut (kecil) lalu membesar dalam badan." },
        { q: "Siapakah Dewi Widowati?", a: ["Crushnya Rahwana", "Anaknya Rahwana", "Permaisuri", "Ibunya Dewi Sinta"], c: "Crushnya Rahwana", h: "Dicintai tapi Widowati ga peka bgt sih.", r: "Setelah Dewi Widowati meninggal, Rahwana tidak mencari pengganti Dewi. Begitu tulus cinta Rahwana kepada Dewi Widowati," },
        { q: "Kumbakarna digambarkan raksasa...", a: ["Banteng", "Gajah", "Raksasa Tinggi", "Monster"], c: "Raksasa Tinggi", h: "Gambarnya raksasa itu gede banget.", r: "Tubuh Kumbakarna sangat besar, menakutkan bagi siapa saja." },
        { q: "Siapa istri Kumbakarna?", a: ["Dewi Tari", "Dewi Citrawati", "Dewi Hidayah", "Dewi Sinta"], c: "Dewi Tari", h: "Istri cantik yang ikut suaminya tindakan kejahatan.", r: "Tari menangis sebagian besar dari Alengka." },
        { q: "Kenapa Rahwana sangat menginginkan Sinta?", a: ["Cantik Parasnya", "Melihat Widowati di dalam diri Sinta", "Pengen punya banyak istri", "Sinta Baik nan Anggunly"], c: "Melihat Widowati di dalam diri Sinta", h: "FYI Sinta adalah titisan Widowati", r: "Rahwana mencintai satu wanita, yaitu Dewi Widowati" },
        { q: "Anoman mengambil aksi (Action) pertama...", a: ["Lari ke Kumbakarna", "Tembak Panah", "Sumbuk Gada", "Masuk Mulut"], c: "Masuk Mulut", h: "Inisiatifnya masuk ke mulut musuh dulu.", r: "Menyerang dari dalam lebih efisien." },
        { q: "Kumbakarna adalah adik dari...", a: ["Rahwana", "Wibisana", "Marica", "Sarpakenaka"], c: "Rahwana", h: "Big Boss (Rahwana) yang overprotective.", r: "Rahwana sangat sayang sama Kumbakarna." },
        { q: "Dalam Ramayana, Kumbakarna dikenal...", a: ["Bodoh", "Pahlawan", "Raksasa Bijak", "Pendeta"], c: "Raksasa Bijak", h: "Meski jahat, dia punya hati nurani.", r: "Dia menderita kejahatan kakaknya tapi tetap hormat." },
        { q: "Apakah Salah jika Rahwana mencintai Sinta?.", a: ["Salah", "Ga ada salahnya", "Benar tapi salah", "Salah tapi benar"], c: "Salah", h: "Dalam cinta tidak ada yang salah", r: "Tapi salahnya ngrebut istri orang dengan memaksakan!" },
        { q: "Siapa yang membangun jembatan Alengka?", a: ["Anoman", "Pasukan Kera", "Wibisana", "Kumbakarna"], c: "Pasukan Kera", h: "(Kera arsitek) yang membuat bangunan.", r: "Jembatan itu terbuat dari susunan batu (Situbanda)." },
        { q: "Kenapa ada Anoman di Tari Kecak?...", a: ["Tokoh Protagonis Epos Ramayana", "Emang ada kocak", "Buat Tambahan", "NPC"], c: "Tokoh Protagonis Epos Ramayana", h: "tarian ini merupakan dramatari yang mengangkat epos Ramayana.", r: "Tari Kecak menceritakan kisah Ramayana, dan Hanoman adalah karakter penting dalam perjalanan Rama menyelamatkan Sita." }
    ]},
    { t: "AKHIR CANDRA: RAMA VS RAHWANA", p: "R", k: "H", n: "RAHWANA", mx: 1000000, q: [
        { q: "Senjata pamungkas yang digunakan Sri Rama untuk mengalahkan Rahwana adalah...", a: ["Panah Guwawijaya", "Panah Pasopati", "Cakra Sudarsana", "Gada Cakrabaswara"], c: "Panah Guwawijaya", h: "Panah peninggalan Dewa Brahma.", r: "Guwawijaya adalah panah yang tidak bisa ditangkal oleh ilmu pancasona Rahwana." },
        { q: "Ilmu kebal Rahwana yang membuatnya bisa bangkit kembali disebut...", a: ["Pancasona", "Aji Bayu", "Suryanala", "Chandrabirawa"], c: "Pancasona", h: "Selama menyentuh tanah, ia hidup.", r: "Anoman harus menahan Rahwana agar tidak menyentuh tanah." },
        { q: "Siapa yang menimbun tubuh Rahwana dengan Gunung Sumawana?", a: ["Anoman", "Sugriwa", "Laksmana", "Wibisana"], c: "Anoman", h: "Agar Rahwana tidak bangkit lagi.", r: "Anoman mengubah rupa menjadi raksasa besar kembali untuk menimbun Rahwana." },
        { q: "Siapa yang memegang kendali kereta perang Rama saat melawan Rahwana?", a: ["Laksmana", "Wibisana", "Sugriwa", "Anggada"], c: "Wibisana", h: "Adik Rahwana yang memihak kebenaran.", r: "Wibisana memandu Rama agar strategi perang tepat sasaran." },
        { q: "Setelah Rahwana tewas, siapa yang menjadi raja Alengka?", a: ["Wibisana", "Indrajit", "Sarpakenaka", "Laksmana"], c: "Wibisana", h: "Sesuai wasiat Rahwana.", r: "Alengka kembali menjadi kerajaan yang adil dan dipimpin oleh Wibisana." },
        { q: "Berapa tahun Rahwana mencintai Sinta", a: ["1 tahun", "2 tahun", "14 tahun", "10 tahun"], c: "14 tahun", h: "bayangin setianya Rahwana kepada Sinta", r: "selama 14 tahun setia, Tapi Sinta juga setia kepada Rama, entah siapa yang salahh~~" },
        { q: "Kekurangan terbesar Rahwana adalah...", a: ["Ego & Toxic", "Bug", "Lag", "Disconnect"], c: "Ego & Toxic", h: "Dia merasa dirinya paling ganteng, nggak mau didebat.", r: "Kombinasi Ego dan Toxic membuatnya sombong." },
        { q: "Rama menyerang Rahwana saat...", a: ["Saat Matahari Terbit", "Shubuh", "Malam Hari", "Siang"], c: "Saat Matahari Terbit", h: "Waktu Rama (Shubuh) dimulai.", r: "Pertempuran terjadi di saat Rama memanah Shubuh." },
        { q: "Kenapa Rahwana tidak menyentuh Sinta?", a: ["Nunggu Sah", "Haram guys", "Terlalu Cinta", "Sinta Disekap"], c: "Terlalu Cinta", h: "Bukan karena tak bisa, tapi...", r: "cinta pada Sinta bukan sekadar obsesi. Ia menunggu, berharap, tanpa pernah memaksa." },
        { q: "Anggota Punakawan yang tinggi kiris siapa yah", a: ["Bagong", "Gareng", "Semar", "Petruk"], c: "Petruk", h: "Sosoknya tinggi kiris, hidung mancing.", r: "Petruk Sosok yang tinggi kurus, dan kidungnya panjang" },
        { q: "Senjata Rahwana adalah...", a: ["Panah Guwawijaya", "Pedang Chandrahasa", "Nagapasa", "Busur Gandewa"], c: "Pedang Chandrahasa", h: "senjata dipake buat motong sayap Jatayu", r: "Senjata sakti pedang damn dari Dewa Brahma" },
        { q: "Pancasona (Kebal Abadi) bisa dimatikan oleh...", a: ["Anoman", "Gunung", "Rahwana sendiri", "Brahma"], c: "Anoman", h: "Anoman menahan Rahwana agar tidak nyentuh tanah.", r: "Anoman menimbun Rahwana dengan Gunung Supit (Gunung merah).", r: "Rahwana tidak akan mati selama Anoman menahan dia dari tanah." },
        { q: "Pancasona sebenarnya adalah...", a: ["Ilmu Sesat", "Harta Karun", "Cheat", "Bug Sistem"], c: "Ilmu Sesat", h: "Warisan leluhur dari leluhur pendah (Ramayana).", r: "Rahwana mendapat ilmu ini dari tapa brata bertahun-tahun." },
        { q: "Rahwana punya berapa kepala?", a: ["5", "7", "10", "100"], c: "10", h: "Dasamuka", r: "Dasamuka memiliki arti Muka 10" },
        { q: "Siapakah pemimpin para Punakawan yang dikenal sebagai titisan dewa dan menjadi penasihat utama Rama?", a: ["Semar", "Petruk", "Gareng", "Bagong"], c: "Semar", h: "Tokoh ini memiliki ciri fisik yang bulat dan selalu tenang.", r: "Semar adalah sosok Kyai Lurah Semar Badranaya yang merupakan titisan Dewa Ismaya" },
        { q: "Bagaimana hasil akhir dari pertempuran?", a: ["Kemenangan Rama", "Kebakaran Kekalahan Alengka", "Sinta Kabur", "Zombie Sinta"], c: "Kemenangan Rama", h: "Good Ending: Alengka hancur, Sinta kembali.", r: "Rahwana tewas, Sinta dibebaskan, Alengka menjadi aman." },
        { q: "Senjata Rama sebelum Guwawijaya...", a: ["Busur Gandewa", "Panah Ardhadari", "Cakra Sudarsana", "Keris"], c: "Busur Gandewa", h: "Ingat Sayembara Mantili?", r: "Busur Gandewa putus (Break) di bab pertama sayembara." },
        { q: "Punakawan sering muncul dalam bagian pertunjukan wayang yang disebut...", a: ["Perang Kembang", "Tancep Krayon", "Goro-goro", "Jejer"], c: "Goro-goro", h: "Istilah ini juga berarti terjadinya kekacauan atau huru-hara alam sebelum mereka muncul.", r: "Goro-goro adalah babak di mana Punakawan muncul untuk mencairkan suasana yang tegang dengan humor dan nasihat." },
        { q: "Apakah Dewi Sinta itu jahat???", a: ["Baik kok", "Jahat bgt asli", "Sesuai kondisi", "Realistis"], c: "Baik kok", h: "kalo dia baik kenapa?", r: "Bahkan mungkin Kesetiaan Rahwana bisa lebih dari Rama yang meragukan kesucian Sinta" },
        { q: "Kenapa Rama meragukan Kesucian Sinta?", a: ["Karena fitnah", "Karena udah disekap Rahwana sejak lama", "Karena pembuktian", "Kesetiaan"], c: "Karena udah disekap Rahwana sejak lama", h: "mempertanyakan moral Sinta setelah lama disekap Rahwana", r: "meskipun Rama sendiri tahu Sinta tidak bersalah; demi memenuhi tugasnya sebagai raja yang adil dan membuktikan kesucian Sinta kepada rakyatnya" },
        { q: "Laksmana membunuh Indrajit (Anak Rahwana) dengan...", a: ["Panah Guwawijaya", "Gada Cakrabaswara", "Nagapasa", "Panah Indrasta"], c: "Panah Indrasta", h: "Laksmana menuju 'Tap Ultimate' menggunakan Indrasta.", r: "Ini salah satu momen 'Play' paling epik di Ramayana." },
        { q: "Dengan apa Rama membuktikan kesucian Sinta?", a: ["Cincin", "Cek USG", "Pengasingan", "Agni Pariksha"], c: "Agni Pariksha", h: "uji api untuk membuktikan kesuciannya.", r: "Api tidak membakar tubuhnya, membuktikan kemurniannya, tetapi desas-desus tetap ada." },
        { q: "Apakah Rahwana BENAR dalam sudut pandang Cinta?", a: ["Benar, dalam Cinta tidak ada yang salah", "Salah, Ngrebut Istri orang disebut cinta ya?"], c: "Benar, dalam Cinta tidak ada yang salah", hint: "Rahwana menculik Sinta bukan sekadar nafsu, melainkan karena yakin Sinta adalah reinkarnasi Dewi Widowati, cinta masa lalunya", r: "Pancasona membuat Rahwana sangat susah dikalahkan." }
    ]}
];

// --- Global Functions ---
window.playSFX = (id, vol = 1) => { const a=$(id); if(a){ a.currentTime=0; a.volume=vol; a.play().catch(()=>{}); }};
window.fadeAudio = (id, d = 1000) => { const a=$(id); if(!a || a.paused) return; const iv=a.volume, st=iv/(d/50); const t=setInterval(()=>{ if(a.volume>st) a.volume-=st; else { a.volume=0; a.pause(); a.volume=iv; clearInterval(t) } }, 50); };

window.setCharState = (target, state) => {
    const imgId = target === 'player' ? 'player-img' : 'enemy-img';
    const img = $(imgId);
    if (!img) return;
    let assetKey = target === 'player' ? S.pk : S.ek; 
    
    if (!AS[assetKey]) assetKey = target === 'player' ? 'R' : 'H'; 
    const assets = AS[assetKey];
    let newSrc = assets.i; 
    img.classList.remove('char-attack', 'char-enemy-attack', 'char-hurt', 'char-dead');
    if (state === 'attack') {
        newSrc = assets.a;
        img.classList.add(target === 'player' ? 'char-attack' : 'char-enemy-attack');
    } else if (state === 'hurt') {
        newSrc = assets.h;
        img.classList.add('char-hurt');
    } else if (state === 'dead') {
        newSrc = assets.d;
        img.classList.add('char-dead');
    }
    img.src = newSrc;
    if (state !== 'dead' && state !== 'idle') {
        setTimeout(() => {
            if (target === 'player') setCharState('player', S.hp <= 0 ? 'dead' : 'idle');
            else setCharState('enemy', S.ehp <= 0 ? 'dead' : 'idle');
        }, 450);
    }
};

window.startNewJourney = () => { 
    playSFX('sfx-confirm'); 
    fadeAudio('audio-menu', 1500); 
    $('menu-screen').style.display='none'; 
    $('story-overlay').style.display='flex'; 
    storyState = 'intro';
    currentStoryKey = 'intro';
    introDone = false;
    S.sceneIndex = 0;
    setTimeout(()=>{ 
        $('story-title').style.opacity='1'; 
        $('story-title').style.transform='translateY(0)'; 
        playStoryIntro(); 
    }, 800); 
};

// Intro Text
const playStoryIntro = async () => { 
    const L_INTRO = "Perjanjian Suci menyebabkan Rama dan Sinta melakukan pengasingan di Hutan dandaka yang penuh Monster dan Raksasa. Sang Dasamuka/Rahwana secara cinta, tidak salah dia mencintai Sinta, karena rasa cinta yang begitu dalam, Rahwana melakukan apapun demi memiliki Sinta";
    
    // Hide Scene Elements
    $('story-scene-img').style.display = 'none';
    $('story-scene-text-box').style.display = 'none';
    // Show Intro Elements
    $('story-title').style.display = 'block';
    $('story-text').style.display = 'block';
    $('skip-story-btn').style.display = 'block';
    $('skip-story-btn').style.opacity='0';

    const el=$('story-text'); el.innerHTML=""; 
    await typeEffect(el, L_INTRO); 
    await new Promise(r=>setTimeout(r, 1000)); 
    $('skip-story-btn').style.opacity='1'; 
    introDone = true; // Allow transition to scenes
};

// Scene Management
window.nextStoryScene = () => {
    const currentScenes = STORY_DATA[currentStoryKey];
    S.sceneIndex++;
    if (S.sceneIndex >= currentScenes.length) {
        finishStorySequence(); // All scenes done
        return;
    }
    renderStoryScene(S.sceneIndex);
};

const finishStorySequence = () => {
    $('story-overlay').style.display='none'; 
    
    // FIX: Tampilkan battle screen kembali agar tidak blank
    $('battle-screen').style.display='flex';

    // Logic after story finishes based on key
    if (currentStoryKey === 'intro') {
        window.startGame(true); 
    } else if (currentStoryKey === 'after1') {
        // BUG FIX HERE: Change from S.l = 2 to S.l = 1
        S.l = 1; 
        loadLevel();
    } else if (currentStoryKey === 'after4') {
        // Story after Bab 4 done -> Go to Bab 5 (Index 4)
        S.l = 4;
        loadLevel();
    } else if (currentStoryKey === 'after5') {
        // Story after Bab 5 done -> Victory
        endGame('victory');
    }
};

const renderStoryScene = (index) => {
    const scenes = STORY_DATA[currentStoryKey];
    const data = scenes[index];
    
    // Hide Intro Elements
    $('story-title').style.display = 'none';
    $('story-text').style.display = 'none';
    $('skip-story-btn').style.display = 'none';

    const imgEl = $('story-scene-img');
    const textBox = $('story-scene-text-box');
    const textContent = $('story-scene-text-content');

    // Show Scene Elements
    imgEl.style.display = 'block';
    textBox.style.display = 'flex';
    textBox.style.animation = 'none';
    textBox.offsetHeight; /* trigger reflow */
    textBox.style.animation = 'fadeInBox 0.8s ease forwards';

    // Update Image
    imgEl.src = data.img;

    // Typewriter effect for text
    textContent.innerHTML = "";
    let i = 0;
    isTyping = true;
    const speed = 30;
    
    if(typeInterval) clearInterval(typeInterval);
    
    typeInterval = setInterval(() => {
        if (i < data.text.length) {
            textContent.innerHTML += data.text.charAt(i);
            i++;
            // Play typing sound occasionally
            if(i % 2 === 0) playSFX('sfx-type', 0.1); 
        } else {
            clearInterval(typeInterval);
            isTyping = false;
            typeInterval = null;
        }
    }, speed);
};

// Play story sequence function used after battles
window.playStorySequence = (key) => {
    $('battle-screen').style.display='none';
    $('story-overlay').style.display='flex';
    currentStoryKey = key;
    storyState = 'scenes';
    S.sceneIndex = 0;
    
    // Hide Intro elements if showing
    $('story-title').style.display = 'none';
    $('story-text').style.display = 'none';
    $('skip-story-btn').style.display = 'none';
    
    renderStoryScene(0);
};

const typeEffect = (el, t) => new Promise(r => { let i=0; const I=setInterval(()=>{ el.innerHTML=t.substring(0,i)+'<span class="cursor"></span>'; i++; if(i>t.length){ clearInterval(I); r(); } }, 35); });

window.startGame = (n) => {
    fadeAudio('audio-menu', 1000); if(n) { S.l=0; S.hp=S.mx; S.sceneIndex=0; } else if(window.saveData) { S.l=window.saveData.l; S.hp = Number(window.saveData.h) || S.mx; }
    $('menu-screen').style.display='none'; $('battle-screen').style.display='flex';
    setCharState('player', 'idle'); 
    loadLevel(); // Audio handled in loadLevel now
};

window.loadLevel = () => {
    const d=DB[S.l]; if(!d) return endGame('victory');
    // Assign Keys
    S.pk = d.p || 'R'; 
    S.ek = d.k || 'H';
    
    // --- MOBILE ZOOM LOGIC ---
    // Reset classes
    document.body.classList.remove('zoom-battle');
    // Apply zoom class for Bab 3 (Index 2), Bab 4 (Index 3), Bab 5 (Index 4)
    if(S.l >= 2) {
        document.body.classList.add('zoom-battle');
    }

    // --- MUSIC LOGIC (UPDATED FOR BAB 5) ---
    $('audio-battle').pause();
    $('audio-battle').currentTime = 0;
    $('audio-boss').pause();
    $('audio-boss').currentTime = 0;
    $('audio-final').pause(); // Stop final boss music if active
    $('audio-final').currentTime = 0;

    if(S.l === 4) {
        // Bab 5 (Final Boss) Specific Music
        playSFX('audio-final'); 
    } else if(S.l >= 3) {
        // Bab 4 (Kumbakarna) Standard Boss Music
        playSFX('audio-boss'); 
    } else {
        // Normal Battle Music
        playSFX('audio-battle');
    }

    // --- UPDATE BACKGROUND PER LEVEL ---
    const bgElement = $('battle-bg');
    if(bgElement) {
        switch(S.l) {
            case 0: 
                bgElement.style.backgroundImage = "url('https://i.postimg.cc/ncc0HkrR/sky.png')"; 
                break;
            case 1: 
                bgElement.style.backgroundImage = "url('https://i.postimg.cc/YqjJ5w8V/laut_alengka.png')"; 
                break;
            case 2: 
                bgElement.style.backgroundImage = "url('https://i.postimg.cc/jdCGprv8/Hutan_Dandaka_Part_3.png')"; 
                break;
            case 3: 
                bgElement.style.backgroundImage = "url('https://i.postimg.cc/L4xcQskW/Hutan_Dandaka_Kijang_Part_1.png')"; 
                break;
            case 4: 
                bgElement.style.backgroundImage = "url('https://i.postimg.cc/NGd3C08H/Battle.png')"; 
                break;
        }
    }
    
    playSFX('sfx-bab'); $('transition-text').innerText = `BAB ${S.l+1}: ${d.t}`; $('level-transition').classList.add('active');
    setTimeout(()=>{
        $('level-transition').classList.remove('active'); S.qi=0; S.emx=d.mx; S.ehp=S.emx;
        $('enemy-name').innerText=d.n; 
        
        if(AS[S.pk]) {
            $('player-name').innerText = AS[S.pk].n.toUpperCase();
        }

        setCharState('enemy', 'idle'); 
        setCharState('player', 'idle'); 
        
        updateHP(); showQuestion(); saveCloud();
    }, 2500);
};

window.showQuestion = () => {
    const d=DB[S.l]; if(!d) return; S.ans=false; if(S.qi === 0) d.q.sort(() => Math.random() - 0.5);
    const q=d.q[S.qi]; $('quiz-content').style.display='block'; $('rationale-box').style.display='none';
    $('question').innerText=q.q; $('level-title').innerText=`TINGKAT ${S.l+1} - SERANGAN ${S.qi+1} / ${d.q.length}`; 
    $('hint-text').innerText=""; const g=$('options'); g.innerHTML='';
    [...q.a].sort(()=>Math.random()-0.5).forEach(v=>{
        const b=document.createElement('button'); b.className='opt-btn'; b.innerText=v;
        b.onclick=()=>{ playSFX('sfx-confirm'); checkAnswer(v===q.c); }; g.appendChild(b);
    });
    startTimer();
};

window.startTimer = () => { 
    clearInterval(S.t); 
    S.tl=12; 
    const f=$('timer-fill'), t=$('timer-text'); 
    $('time-vignette').classList.remove('pulsing'); 
    
    S.t=setInterval(()=>{ 
        S.tl-=0.1; 
        t.innerText=Math.max(0,Math.ceil(S.tl)); 
        f.style.width=(S.tl/12*100)+'%'; 

        if(S.tl <= 6) {
            $('time-vignette').classList.add('pulsing');
        } else {
            $('time-vignette').classList.remove('pulsing');
        }

        if(S.tl<=0){ 
            clearInterval(S.t); 
            $('time-vignette').classList.remove('pulsing');
            takeDamage(15000); 
        } 
    }, 100); 
};

window.checkAnswer = (c) => { if(S.ans) return; S.ans=true; clearInterval(S.t); $('time-vignette').classList.remove('pulsing'); if(c) { if(S.hp<S.mx){ S.hp=Math.min(S.mx, S.hp+2000); floatTxt(2000, true, -20); } attackEnemy(); } else takeDamage(18000); };

window.attackEnemy = () => {
    const d=DB[S.l], dmg = Math.ceil(S.emx / d.q.length) + Math.floor(Math.random() * 2000);
    setCharState('player', 'attack');
    setTimeout(() => {
        S.ehp -= dmg; setCharState('enemy', S.ehp <= 0 ? 'dead' : 'hurt');
        playSFX('sfx-hit-enemy'); createFX('enemy-img'); floatTxt(dmg, false, 20);
        $('game-container').classList.add('shake'); updateHP();
        setTimeout(() => { $('game-container').classList.remove('shake'); showRationale(); }, 200);
    }, 200);
};

window.takeDamage = (dmg) => {
    S.hp-=dmg; setCharState('enemy', 'attack');
    setTimeout(() => {
        $('damage-overlay').style.opacity = 1; setTimeout(() => $('damage-overlay').style.opacity = 0, 150);
        setCharState('player', S.hp <= 0 ? 'dead' : 'hurt');
        playSFX('sfx-hit-player'); createFX('player-img'); floatTxt(dmg, false, -20);
        $('game-container').classList.add('shake'); updateHP();
        setTimeout(() => { $('game-container').classList.remove('shake'); if(S.hp<=0) endGame('gameover'); else showRationale(); }, 200);
    }, 200);
};

window.showRationale = () => {
    const q=DB[S.l].q[S.qi]; $('quiz-content').style.display='none'; $('rationale-box').style.display='block';
    $('rationale-text').innerHTML=`<span style="color:var(--gold);font-family:'Cinzel';">PAWISIK:</span><br>${q.r}`;
};

window.nextAction = () => {
    playSFX('sfx-confirm'); 
    
    if(S.ehp<=0) { 
        // Check for Post-Battle Stories
        if (S.l === 0) { 
            // After Bab 1 (Jatayu)
            playStorySequence('after1');
        } else if (S.l === 3) { 
            // After Bab 4 (Kumbakarna)
            playStorySequence('after4');
        } else if (S.l === 4) { 
            // After Bab 5 (Rahwana)
            playStorySequence('after5');
        } else { 
            // Standard Level Progression
            S.l++; 
            if(S.l >= DB.length) endGame('victory'); 
            else loadLevel(); 
        }
        return; 
    }
    
    S.qi++; if(S.qi >= DB[S.l].q.length) S.qi = 0; showQuestion();
};

window.updateHP = () => {
    $('player-hp').style.width=(S.hp/S.mx*100)+'%'; $('enemy-hp').style.width=(Math.max(0,S.ehp)/S.emx*100)+'%';
    $('player-hp-text').innerText=`${Math.max(0,Math.floor(S.hp)).toLocaleString('id-ID')} / 100.000`;
    $('enemy-hp-text').innerText=`${Math.max(0,Math.floor(S.ehp)).toLocaleString('id-ID')} / ${S.emx.toLocaleString('id-ID')}`;
};

window.createFX = (tid) => {
    const t=$(tid); if(!t) return; const r=t.getBoundingClientRect();
    const c=document.createElement('div'); c.className='explosion-fire'; c.style.left=(r.left+r.width/2-75)+'px'; c.style.top=(r.top+r.height/2-75)+'px';
    c.innerHTML='<div class="fire-core"></div>'; document.body.appendChild(c);
    $('screen-flash').style.opacity=0.8; setTimeout(()=>$('screen-flash').style.opacity=0, 200);
    setTimeout(()=>c.remove(), 700);
};

window.floatTxt = (val, h, xOff) => {
    const d=document.createElement('div'); d.className='floating-text'; d.innerText=(h?"+":"-")+Math.floor(val).toLocaleString('id-ID');
    d.style.color=h?"#2ecc71":"#ff4d4d"; d.style.left=(50+xOff)+'%'; d.style.top="35%"; $('battle-screen').appendChild(d); setTimeout(()=>d.remove(), 1000);
};

window.useHint = () => { playSFX('sfx-confirm'); $('hint-text').innerText=" "+DB[S.l].q[S.qi].h; };
window.endGame = (type) => { clearInterval(S.t); 
    // Stop music
    $('audio-battle').pause();
    $('audio-boss').pause();
    $('audio-final').pause(); // Stop final music
    
    fadeAudio(type==='victory' ? 'audio-final' : (S.l >= 3 ? 'audio-boss' : 'audio-battle'), 800); 
    $(type+'-screen').style.display='flex'; 
    playSFX(type==='victory'?'sfx-jayanti':'sfx-petjah', 1); 
};
window.retryLevel = () => { S.hp=S.mx; $('gameover-screen').style.display='none'; 
    // Ensure correct music plays on retry
    if(S.l === 4) playSFX('audio-final');
    else if(S.l >= 3) playSFX('audio-boss');
    else playSFX('audio-battle');
    loadLevel(); 
};
window.backToMenu = (fs) => { playSFX('sfx-back'); clearInterval(S.t); $('victory-screen').style.display='none'; $('gameover-screen').style.display='none'; $('battle-screen').style.display='none'; $('menu-screen').style.display='flex'; $('audio-battle').pause(); $('audio-boss').pause(); $('audio-final').pause(); playSFX('audio-menu'); if(S.uid) loadCloud(S.uid); };

window.saveCloud = async () => { if(!S.uid) return; try { await setDoc(doc(db,'artifacts',appId,'users',S.uid,'saveData','progress'), { l:S.l, h:S.hp, t:new Date().toISOString() }, {merge:true}); } catch(e){} };

const loadCloud = async uid => {
    const cStatus = $('cloud-status');
    const uResume = $('ui-resume');
    try {
        const snap = await getDoc(doc(db, 'artifacts', appId, 'users', uid, 'saveData', 'progress'));
        if(snap.exists()){
            window.saveData = snap.data();
            if (uResume) uResume.style.display = 'block';
            if (cStatus) cStatus.innerText = "Cloud Sync: Bab " + (window.saveData.l + 1);
        } else {
            if (cStatus) cStatus.innerText = "Cloud Sync: Baru";
        }
    } catch(e) {
        if (cStatus) cStatus.innerText = "Cloud Sync: Error";
    }
};

const preloadAssets = () => {
    return new Promise((resolve) => {
        let loadedCount = 0;
        const urls = [];
        Object.values(AS).forEach(char => Object.values(char).forEach(src => urls.push(src)));
        urls.push('https://i.postimg.cc/ncc0HkrR/sky.png');
        urls.push('https://i.postimg.cc/YqjJ5w8V/laut_alengka.png');
        urls.push('https://i.postimg.cc/jdCGprv8/Hutan_Dandaka_Part_3.png');
        urls.push('https://i.postimg.cc/L4xcQskW/Hutan_Dandaka_Kijang_Part_1.png');
        urls.push('https://i.postimg.cc/NGd3C08H/Battle.png');
        urls.push('https://i.postimg.cc/7YbpFym8/Menu.png');
        
        // Flatten all story images
        Object.keys(STORY_DATA).forEach(key => {
            STORY_DATA[key].forEach(s => urls.push(s.img));
        });
        
        const totalAssets = urls.length;
        urls.forEach(src => {
            const img = new Image();
            img.src = src;
            img.onload = () => {
                loadedCount++;
                const percent = Math.floor((loadedCount / totalAssets) * 100);
                const fill = $('loader-fill');
                const status = $('loading-status');
                if (fill) fill.style.width = percent + '%';
                if (status) status.innerText = `MEMUAT TAKDIR... ${percent}%`;
                if(loadedCount === totalAssets) setTimeout(resolve, 500);
            };
            img.onerror = () => { loadedCount++; if(loadedCount === totalAssets) resolve(); };
        });
    });
};

const createFire = () => {
    const c = $('fire-container');
    if (!c) return;
    const cl = ['#ff4500','#ff8c00','#ffcc00','#fff'];
    for(let i=0; i<35; i++){
        const s = document.createElement('div');
        s.className = 'spark';
        const z = Math.random() * 4 + 2;
        s.style.width = z + 'px';
        s.style.height = z + 'px';
        s.style.left = Math.random() * 100 + '%';
        s.style.background = cl[Math.floor(Math.random() * 4)];
        s.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
        s.style.setProperty('--drift', (Math.random() * 200 - 100) + 'px');
        s.style.animationDelay = Math.random() * 5 + 's';
        c.appendChild(s);
    }
};

// --- Event Listeners ---
 $('story-overlay').addEventListener('click', () => {
    if (isTyping) {
        if(typeInterval) {
            clearInterval(typeInterval);
            typeInterval = null;
        }
        isTyping = false;
        
        if(storyState === 'intro') {
             const L_INTRO = "Perjanjian Suci menyebabkan Rama dan Sinta melakukan pengasingan di Hutan dandaka yang penuh Monster dan Raksasa. Sang Dasamuka/Rahwana secara cinta, tidak salah dia mencintai Sinta, karena rasa cinta yang begitu dalam, Rahwana melakukan apapun demi memiliki Sinta";
             $('story-text').innerHTML = L_INTRO;
             $('skip-story-btn').style.opacity='1';
             introDone = true;
        } else if (storyState === 'scenes') {
            const data = STORY_DATA[currentStoryKey][S.sceneIndex];
            document.getElementById('story-scene-text-content').innerHTML = data.text;
        }
        return;
    }

    if (storyState === 'intro') {
        if (introDone) {
            storyState = 'scenes';
            S.sceneIndex = 0;
            renderStoryScene(0);
        }
    } else if (storyState === 'scenes') {
        nextStoryScene();
    }
});

// --- Initialization ---
window.onload = () => {
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
    appId = typeof __app_id !== 'undefined' ? __app_id : 'aksara-ramayana-karaton';
    
    if (Object.keys(firebaseConfig).length > 0) {
        const fbApp = initializeApp(firebaseConfig);
        auth = getAuth(fbApp);
        db = getFirestore(fbApp);

        onAuthStateChanged(auth, u => {
            if(u){
                S.uid = u.uid;
                loadCloud(u.uid);
            } else {
                signInAnonymously(auth).catch(e => console.error("Auth error:", e));
            }
        });
    }

    createFire();
    preloadAssets().then(() => {
        const overlay = $('loading-overlay');
        if (overlay) overlay.style.opacity = 0;
        setTimeout(() => {
            if (overlay) overlay.style.display = 'none';
            playSFX('audio-menu');
        }, 500);
    });
};
</script>
</body>
</html>
